<div class="grid-row">
  <div class="column-full">
    <div id="user-status">
      <p>
        <%= t(".user_info.signed_in_user", email: current_user.email) %>
        <%= link_to t(".user_info.sign_out_link"), destroy_user_session_path %>
      </p>
    </div>
  </div>
</div>

<div class="grid-row">
  <div class="column-full">
    <h1 class="heading-large">
      <%= t(".heading") %>
    </h1>
  </div>
</div>

<div class="grid-row">
  <div class="column-full">
    <p><%= t(".search.paragraph_1") %></p>
    <ul class="list list-bullet">
      <% t(".search.searchable_attributes").each do |attribute| %>
        <li><%= attribute %></li>
      <% end %>
    </ul>
    <p><%= t(".search.paragraph_2") %></p>
    <div class="form-group">
      <%= form_tag("/bo", method: :get) do %>
        <%= label_tag :term, t(".search.label"), class: "form-label visually-hidden" %>
        <%= text_field_tag :term, @term, placeholder: t(".search.placeholder"), class: "form-control" %>
        <%= submit_tag t(".search.submit"), class: "button" %>
      <% end %>
    </div>
  </div>
</div>

<% if @transient_registrations.present? %>
  <div class="grid-row">
    <div class="column-full">
      <table>
        <caption>
          <h2 class="heading-medium">
            <%= t(".results.caption", count: @transient_registrations.count) %>
          </h2>
        </caption>
        <thead>
          <tr>
            <th><%= t(".results.th.reg_identifier") %></th>
            <th><%= t(".results.th.company_name") %></th>
            <th><%= t(".results.th.status") %></th>
            <th><%= t(".results.th.last_modified") %></th>
            <th><%= t(".results.th.actions") %></th>
          </tr>
        </thead>
        <tbody>
          <% @transient_registrations.each do |transient_registration| %>
            <tr>
              <td>
                <%= transient_registration.reg_identifier %>
              </td>
              <td>
                <%= transient_registration.company_name %>
              </td>
              <td>
                <% if transient_registration.metaData.REVOKED? %>
                  <strong class="app-c-tag app-c-tag--danger">
                    <%= t(".results.statuses.rejected") %>
                  </strong>
                <% elsif transient_registration.renewal_application_submitted? %>
                    <% if transient_registration.pending_payment? %>
                      <strong class="app-c-tag app-c-tag--success">
                        <%= t(".results.statuses.pending_payment") %>
                      </strong>
                    <% end %>
                    <% if transient_registration.pending_manual_conviction_check? %>
                      <strong class="app-c-tag app-c-tag--warning">
                        <%= t(".results.statuses.pending_conviction_check") %>
                      </strong>
                    <% end %>
                    <% if transient_registration.stuck? %>
                      <strong class="app-c-tag app-c-tag--danger">
                        <%= t(".results.statuses.stuck") %>
                      </strong>
                    <% end %>
                <% else %>
                  <strong class="app-c-tag">
                    <%= t(".results.statuses.in_progress") %>
                  </strong>
                <% end %>
              </td>
              <td>
                <%= transient_registration.metaData.last_modified.in_time_zone("London").strftime("%H:%M %d/%m/%Y") %>
              </td>
              <td>
                <%= link_to t(".results.details_button"), transient_registration_path(transient_registration.reg_identifier) %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="grid-row">
    <div class="column-full">
      <nav role="navigation" class="pagination" aria-label="Pagination">
        <div class="pagination__summary">
          <%= page_entries_info @transient_registrations, entry_name: "item" %>
        </div>
        <%= paginate @transient_registrations %>
      </nav>
    </div>
  </div>

<% elsif @search_terms_or_filters_present %>

<hr>

<div class="grid-row">
  <div class="column-full">
    <p><%= t(".results.no_results") %></p>
  </div>
</div>

<% end %>
