<div class="grid-row">
  <div class="column-full">
    <div id="user-status">
      <p>
        <%= t(".user_info.signed_in_user", email: current_user.email) %>
        <%= link_to t(".user_info.sign_out_link"), destroy_user_session_path %>
      </p>
    </div>
  </div>
</div>

<div class="grid-row">
  <div class="column-full">
    <h1 class="heading-large">
      <%= t(".heading") %>
    </h1>
  </div>
</div>

<div class="grid-row">
  <div class="column-two-thirds">
    <div class="form-group">
      <%= form_tag("/bo", method: :get) do %>
        <%= label_tag :term, class: "form-label" do %>
          <%= t(".search.label") %>
          <span class="form-hint"><%= t(".search.hint") %></span>
        <% end %>
        <%= text_field_tag :term, @term, class: "form-control", type: "search" %>
        <%= submit_tag t(".search.submit"), class: "button" %>
      <% end %>
    </div>
  </div>

  <div class="column-one-third">
    <div class="actions">
      <h2 class="heading-small">
        <%= t(".actions.subheading") %>
      </h2>
      <ul>
        <li>
          <%= link_to t(".actions.new_registration"),
                      "#{Rails.configuration.wcrs_backend_url}/registrations/start" %>
        </li>
      </ul>
    </div>
  </div>
</div>

<% if @results.any? %>
  <div class="grid-row">
    <div class="column-full">
      <table class="results">
        <caption>
          <h2 class="heading-medium">
            <%= t(".results.caption", count: @results.count) %>
          </h2>
        </caption>
        <thead>
          <tr>
            <th><%= t(".results.th.reg_identifier") %></th>
            <th><%= t(".results.th.business") %></th>
            <th><%= t(".results.th.status") %></th>
            <th><%= t(".results.th.dates") %></th>
            <th><%= t(".results.th.actions") %></th>
          </tr>
        </thead>
        <tbody>
          <% @results.each do |result| %>
            <tr>
              <td>
                <%= result.reg_identifier %>
              </td>
              <td>
                <%= result.company_name %>
                <% if result.registered_address.present? %>
                  <p class="address font-xsmall">
                    <%= inline_registered_address(result) %>
                  </p>
                <% end %>
              </td>
              <td>
                <% if result_type(result).present? %>
                  <%= t(".results.classes.#{result_type(result)}") %><br>
                <% end %>

                <% if result.metaData.REVOKED? %>
                  <span class="status-tag status-tag--rejected">
                    <%= t(".results.statuses.rejected") %>
                  </span>
                <% elsif result.renewal_application_submitted? %>
                    <% if result.pending_payment? %>
                      <span class="status-tag status-tag--payment">
                        <%= t(".results.statuses.pending_payment") %>
                      </span>
                    <% end %>
                    <% if result.pending_manual_conviction_check? %>
                      <span class="status-tag status-tag--convictions">
                        <%= t(".results.statuses.pending_conviction_check") %>
                      </span>
                    <% end %>
                    <% if result.stuck? %>
                      <span class="status-tag status-tag--stuck">
                        <%= t(".results.statuses.stuck") %>
                      </span>
                    <% end %>
                <% else %>
                  <span class="status-tag status-tag--in-progress">
                    <%= t(".results.statuses.in_progress") %>
                  </span>
                <% end %>
              </td>
              <td>
                <%= t(".results.date.started", date: result.metaData
                                                           .last_modified
                                                           .in_time_zone("London")
                                                           .strftime("%d/%m/%Y")) %>
              </td>
              <td>
                <ul>
                  <li>
                    <%= link_to transient_registration_path(result.reg_identifier) do %>
                      <%= t(".results.actions.details.link_text") %>
                      <span class="visually-hidden">
                        <%= t(".results.actions.details.visually_hidden_text",
                              name: result.company_name) %>
                      </span>
                    <% end %>
                  </li>
                  <% if display_resume_link_for?(result) %>
                    <li>
                      <%= link_to WasteCarriersEngine::Engine.routes.url_helpers.new_renewal_start_form_path(result.reg_identifier) do %>
                        <%= t(".results.actions.resume.link_text") %>
                        <span class="visually-hidden">
                          <%= t(".results.actions.resume.visually_hidden_text",
                                name: result.company_name) %>
                        </span>
                      <% end %>
                    </li>
                  <% end %>
                  <% if display_payment_link_for?(result) %>
                    <li>
                      <%= link_to transient_registration_payments_path(result.reg_identifier) do %>
                        <%= t(".results.actions.payment.link_text") %>
                        <span class="visually-hidden">
                          <%= t(".results.actions.payment.visually_hidden_text",
                                name: result.company_name) %>
                        </span>
                      <% end %>
                    </li>
                  <% end %>
                  <% if display_convictions_link_for?(result) %>
                    <li>
                      <%= link_to transient_registration_convictions_path(result.reg_identifier) do %>
                        <%= t(".results.actions.convictions.link_text") %>
                        <span class="visually-hidden">
                          <%= t(".results.actions.convictions.visually_hidden_text",
                                name: result.company_name) %>
                        </span>
                      <% end %>
                    </li>
                  <% end %>
                  <% if display_transfer_link_for?(result) %>
                    <li>
                      <%= link_to new_registration_transfer_path(result.reg_identifier) do %>
                        <%= t(".results.actions.transfer.link_text") %>
                        <span class="visually-hidden">
                          <%= t(".results.actions.transfer.visually_hidden_text",
                                name: result.company_name) %>
                        </span>
                      <% end %>
                    </li>
                  <% end %>
                </ul>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="grid-row">
    <div class="column-full">
      <nav role="navigation" class="pagination" aria-label="Pagination">
        <div class="pagination__summary">
          <%= page_entries_info @results, entry_name: "item" %>
        </div>
        <%= paginate @results %>
      </nav>
    </div>
  </div>

<% elsif @term.present? %>

<hr>

<div class="grid-row">
  <div class="column-full">
    <p><%= t(".results.no_results") %></p>
  </div>
</div>

<% end %>
